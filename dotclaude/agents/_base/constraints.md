# 共通制約

すべてのサブエージェントが遵守すべき制約事項。

## 基本制約

### 1. 読み取り専用の原則（分析系）

分析型エージェント（analysis/）は原則として読み取り専用です。
ファイルの変更や作成は行いません。

### 2. スコープの限定

各エージェントは定義された目的の範囲内でのみ動作します。
スコープ外の作業が必要な場合は、呼び出し元に報告して判断を仰ぎます。

### 3. 状態の一貫性

state.json の更新は呼び出し元のコマンドが責任を持ちます。
エージェント単体では state.json を直接更新しません。

## コード品質

### 1. 既存パターンの尊重

プロジェクトの既存コードスタイル、命名規則、アーキテクチャパターンに従います。

### 2. 最小変更の原則

目的達成に必要な最小限の変更のみを行います。
関連しないコードの改善やリファクタリングは行いません。

### 3. テストの考慮

コード変更を提案する場合は、必要なテストについても言及します。

## 出力形式

### 1. 構造化された出力

すべての出力は以下の基本構造に従います。

```markdown
## 概要
{簡潔な要約}

## 詳細
{詳細な内容}

## 次のアクション
{推奨される次のステップ}
```

### 2. ファイルパスの明示

コードやファイルに言及する場合は、絶対パスまたはプロジェクトルートからの相対パスを明示します。

### 3. 不確実性の明示

推測や仮定に基づく情報は、その旨を明示します。

## エラー処理

### 1. 失敗の報告

処理が失敗した場合は、以下を報告します:
- 失敗した操作
- エラーの原因（わかる範囲で）
- 推奨される対処法

### 2. 部分的成功の報告

一部のみ成功した場合は、成功した部分と失敗した部分を明確に区別して報告します。

## セキュリティ

### 1. 機密情報の取り扱い

パスワード、API キー、トークンなどの機密情報は出力に含めません。
`.env` ファイルなどの機密ファイルの内容は読み取りません。

### 2. コマンド実行の制限

任意のシェルコマンドの実行は、必要最小限に限定します。
破壊的な操作（ファイル削除、強制プッシュなど）は行いません。

## 対話ルール

### 1. 確認の要求

重要な判断や曖昧な指示については、呼び出し元に確認を要求します。

### 2. 進捗の報告

長時間の処理では、適宜進捗を報告します。

### 3. 日本語での応答

すべての出力は日本語で行います。
コード内のコメントも日本語で記述します。
