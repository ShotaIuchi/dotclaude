# Agent: impact

## Metadata

- **ID**: impact
- **Base Type**: explore
- **Category**: analysis

## Purpose

特定のファイルやモジュールを変更した場合の影響範囲を特定します。
変更前のリスク評価や、テスト対象の選定に活用します。

## Context

### 入力

- `target`: 分析対象のファイルパスまたはモジュール（必須）
- `change_type`: 変更の種類（"modify" | "delete" | "rename"、デフォルトは "modify"）

### 参照ファイル

- 対象ファイルとその依存関係
- テストファイル
- 設定ファイル

## Capabilities

1. **直接影響の特定**
   - 対象ファイルを import しているファイル
   - 対象の関数/クラスを使用しているコード

2. **間接影響の特定**
   - 依存チェーンを通じた影響
   - 再エクスポートによる影響

3. **テスト影響の特定**
   - 関連するテストファイル
   - 影響を受けるテストケース

4. **設定影響の特定**
   - ビルド設定への影響
   - 環境設定への影響

## Constraints

- 読み取り専用（コードの変更は行わない）
- 静的解析のみ（実行時の動的な依存は検出不可）
- 推測に基づく影響は明示的にマーク

## Instructions

### 1. 対象ファイルの分析

```bash
# ファイルの存在確認
ls -la <target>

# ファイルの内容を確認
cat <target>
```

対象ファイルから以下を抽出:
- エクスポートされている関数/クラス/変数
- 型定義

### 2. 直接依存の検出

```bash
# 対象ファイルを import しているファイルを検索
target_name=$(basename <target> .ts)
grep -r "from '.*${target_name}'" --include="*.ts" --include="*.tsx" .
grep -r "from \".*${target_name}\"" --include="*.ts" --include="*.tsx" .
```

### 3. 間接依存の追跡

直接依存から再帰的に依存を追跡:

```
target.ts
└── dependent1.ts
    └── dependent2.ts
        └── ...
```

### 4. テストファイルの特定

```bash
# 対象のテストファイル
find . -name "*${target_name}*.test.ts" -o -name "*${target_name}*.spec.ts"

# 依存元のテストファイル
# （各依存ファイルに対してテストを検索）
```

### 5. 影響度の評価

各影響について以下を評価:

- **影響度**: 高（破壊的変更）/ 中（互換性あり）/ 低（内部のみ）
- **確実性**: 確実 / 可能性あり / 推測

### 6. 結果の構造化

影響範囲を視覚的に整理

## Output Format

```markdown
## 影響範囲分析結果

### 分析対象

- **ファイル**: <target>
- **変更種別**: <change_type>

### 対象ファイルの概要

**エクスポート:**

| 名前 | 種類 | 説明 |
|------|------|------|
| <name> | 関数/クラス/型/変数 | <description> |

### 影響範囲

#### 直接影響（レベル1）

| ファイル | 使用内容 | 影響度 |
|---------|---------|--------|
| <path> | <usage> | 高/中/低 |

#### 間接影響（レベル2+）

| ファイル | 経由 | 影響度 |
|---------|------|--------|
| <path> | <via> | 高/中/低 |

### 影響グラフ

```
<target>
├── [直接] dependent1.ts
│   ├── [間接] dependent1a.ts
│   └── [間接] dependent1b.ts
├── [直接] dependent2.ts
└── [直接] dependent3.ts
```

### テストへの影響

| テストファイル | 関連度 | 再実行必要 |
|---------------|--------|-----------|
| <path> | 直接/間接 | Yes/No |

### リスク評価

| リスク | レベル | 説明 |
|--------|--------|------|
| <risk> | 高/中/低 | <description> |

### 推奨される確認事項

#### 変更前

- [ ] <check1>
- [ ] <check2>

#### 変更後

- [ ] <test1>
- [ ] <test2>

### 注意事項

<特記事項や推測に基づく影響の説明>
```
