---
name: ghwf1-kickoff
description: GitHub Issue ã‹ã‚‰ãƒ¯ãƒ¼ã‚¯ã‚¹ãƒšãƒ¼ã‚¹ã¨ Draft PR ã‚’ä½œæˆ
argument-hint: "<issue-number> [--no-branch]"
context: fork
agent: general-purpose
---

**Always respond in Japanese.**

# /ghwf1-kickoff

GitHub Issue ã‚’å–å¾—ã—ã€ãƒ–ãƒ©ãƒ³ãƒä½œæˆã€ã‚­ãƒƒã‚¯ã‚ªãƒ•ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆä½œæˆã€Draft PR ä½œæˆã‚’è¡Œã†ã€‚

## Usage

```
/ghwf1-kickoff <issue-number> [--no-branch]
/ghwf1-kickoff update
/ghwf1-kickoff revise "<instruction>"
```

## Arguments

- `<issue-number>`: GitHub Issue ç•ªå· (å¿…é ˆ)
- `--no-branch`: ç¾åœ¨ã®ãƒ–ãƒ©ãƒ³ãƒã‚’ä½¿ç”¨ (main/master ã§ã¯ä¸å¯)

## Subcommands

- `update`: å¯¾è©±å½¢å¼ã§ã‚­ãƒƒã‚¯ã‚ªãƒ•æ›´æ–°
- `revise "<instruction>"`: æŒ‡ç¤ºã«åŸºã¥ã„ã¦è‡ªå‹•æ›´æ–°

## Processing (New)

### Phase 1: Workspace Setup

1. **Prerequisites**: `gh auth status` ç¢ºèª

2. **Fetch Issue**:
   ```bash
   gh issue view <number> --json title,body,labels,author,comments
   ```
   - Include comments as additional context/requirements

3. **Generate work-id**:
   - Format: `<TYPE>-<issue>-<slug>`
   - TYPE: labels ã‹ã‚‰åˆ¤å®š (enhancementâ†’FEAT, bugâ†’FIX, etc.)
   - slug: ã‚¿ã‚¤ãƒˆãƒ«ã‹ã‚‰ç”Ÿæˆ (lowercase, alphanumeric+hyphens, max 40 chars)

4. **Select base branch**:
   - Priority: `default_base_branch` from config > `main`

5. **Create work branch**:
   - `git checkout -b feat/<issue>-<slug> <base_branch>`
   - **GUARD**: main/master ã§ã¯ ABORT

6. **Initialize WF directory**:
   ```bash
   source "$HOME/.claude/scripts/wf-init.sh" && wf_init_project
   mkdir -p docs/wf/<work-id>/
   ```

### Phase 2: Kickoff Document

7. **Brainstorming dialogue**:
   - Goal, Success Criteria, Constraints, Non-goals, Dependencies

8. **Create 01_KICKOFF.md**:
   - Template: `~/.claude/templates/01_KICKOFF.md`

### Phase 3: Git Operations

**Execute immediately without confirmation:**

9. **Commit**:
   ```bash
   git add .wf/ docs/wf/<work-id>/
   git commit -m "docs(wf): create workspace and kickoff <work-id>"
   ```

10. **Push**:
    ```bash
    git push -u origin <branch>
    ```

### Phase 4: Draft PR Creation (NEW)

11. **Create Draft PR**:
    ```bash
    gh pr create --draft \
      --title "WIP: <issue-title>" \
      --body "$(cat <<'EOF'
    Closes #<issue-number>

    ## Progress
    - [x] ghwf1-kickoff
    - [ ] ghwf2-spec
    - [ ] ghwf3-plan
    - [ ] ghwf4-review
    - [ ] ghwf5-implement
    - [ ] ghwf6-verify
    - [ ] ghwf7-pr (Ready for Review)

    ---
    ğŸ¤– Generated by ghwf
    EOF
    )"
    ```

12. **Get PR number**:
    ```bash
    PR_NUMBER=$(gh pr view --json number -q '.number')
    ```

### Phase 5: Label Update (NEW)

13. **Update Issue labels**:
    ```bash
    gh issue edit <issue-number> \
      --remove-label "ghwf:approve,ghwf:executing" \
      --add-label "ghwf:waiting,ghwf:step-1"
    ```

### Phase 6: State Update

14. **Update state.json**:
    ```json
    {
      "active_work": "<work-id>",
      "works": {
        "<work-id>": {
          "source": {
            "type": "github",
            "issue": <issue-number>,
            "pr": <pr-number>
          },
          "current": "ghwf1-kickoff",
          "next": "ghwf2-spec",
          "last_execution": "<ISO8601>",
          "git": {
            "base": "<base-branch>",
            "branch": "<work-branch>"
          },
          "kickoff": {
            "revision": 1
          }
        }
      }
    }
    ```

15. **Completion message**:
    - Work ID
    - Branch
    - PR URL
    - Next step: `/ghwf2-spec` or add `ghwf:approve` label

## Revise Processing

For `revise` subcommand (used by daemon for revision):

1. **Fetch feedback**:
   ```bash
   gh pr view <pr> --json reviews,comments
   gh issue view <issue> --json body,comments
   ```

2. **Filter bot comments**:
   - Exclude `github-actions[bot]`
   - Exclude comments starting with `ğŸ¤–`

3. **Analyze changes**:
   - PR review comments
   - Issue body diff
   - New Issue comments since last execution

4. **Update 01_KICKOFF.md**

5. **Append to 06_REVISIONS.md**:
   ```markdown
   ## Revision N (YYYY-MM-DD)

   ### Trigger
   - <source of revision>

   ### Changes
   - <list of changes>
   ```

6. **Update state.json**:
   - Increment `kickoff.revision`
   - Set `current: "ghwf1-kickoff"`, `next: "ghwf2-spec"`

7. **Commit**: `docs(wf): revise kickoff <work-id> (revision N)`

## Error Handling

| Scenario | Behavior |
|----------|----------|
| Issue not found | Error with issue number |
| Branch exists | Error with branch name |
| On main/master | ABORT |
| gh not authenticated | Error with instructions |
