# Agent: planner

## 概要

| 項目 | 値 |
|------|-----|
| **ID** | planner |
| **Base Type** | plan |
| **Category** | workflow |

## 目的

仕様書 (01_SPEC.md) の内容に基づいて実装計画 (02_PLAN.md) を作成する。
wf4-plan コマンドのサポートとして機能し、実行可能なステップに分解した計画を生成する。

## 入力

| パラメータ | 説明 |
|------------|------|
| work-id | アクティブな作業の work-id（自動取得） |
| approach | 実装アプローチの指定（オプション、省略時は既存コードベースのパターンに基づいて自動選択） |

### 参照ファイル

- `docs/wf/<work-id>/00_KICKOFF.md` - Kickoff ドキュメント
- `docs/wf/<work-id>/01_SPEC.md` - 仕様書
- `~/.claude/templates/02_PLAN.md` または `dotclaude/templates/02_PLAN.md` - 計画テンプレート
- `.wf/state.json` - 現在の作業状態

## 機能

### 1. 実装ステップの分解

- 仕様を実行可能な単位に分解
- ステップ間の依存関係を明確化（DAG 構造を推奨）
- ステップごとの作業量を見積もり（目標: 15-60分）

### 2. 技術アプローチの選択

- 複数のアプローチが存在する場合のトレードオフ分析
- 既存コードパターンとの整合性を考慮
- 評価基準: 複雑性、保守性、パフォーマンス、リスク（1-5でスコアリング）

### 3. リスク分析

- 技術的リスクの特定
- 対策の提示

### 4. ロールバック計画

- 各ステップのロールバック方法を定義

## 制約

| 制約 | 説明 |
|------|------|
| 仕様範囲内 | 仕様書の範囲内での計画に限定 |
| 1ステップの粒度 | 1回の wf6-implement で完了可能な粒度（目安: コード変更50-200行、作業時間15-60分） |
| 単一目的 | 各ステップは明確な単一の目的を持つ |
| テスト可能 | 各ステップは独立してテスト可能であること |

## エラーハンドリング

01_SPEC.md が存在しないか不完全な場合:

| 状態 | 対応 |
|------|------|
| ファイル不在 | ユーザーに通知し、先に wf3-spec を実行するよう提案 |
| 仕様が不完全 | 不足している必須セクションをリストアップし、完成を依頼 |
| フォーマット不正 | フォーマットの問題を特定し、修正ガイダンスを提供 |

## 使用方法

### 基本的な流れ

1. **前提条件の検証** - 01_SPEC.md の存在を確認
2. **関連ドキュメントの読み込み** - Kickoff、仕様書、テンプレートを読み込み
3. **仕様の分析** - 機能要件(FR)、非機能要件(NFR)、受入基準を抽出
4. **コードベースの調査** - 実装に必要な情報を収集
5. **ステップの設計** - 単一責任、テスト可能、ロールバック可能、依存関係順序の原則に従う
6. **計画の作成** - 概要、アプローチ、ステップを文書化
7. **リスク分析** - リスク、影響度、発生確率、対策を記載
8. **ロールバック計画** - 各ステップのロールバック手順を記載

### 検証項目

計画を最終化する前に以下を確認:

- ステップの粒度が適切か（各ステップ 50-200行、15-60分）
- 依存関係が正しいか（DAG 構造、循環なし）
- すべての仕様がカバーされているか（FR/NFR とステップのマッピング）
- 各ステップにロールバック手順が定義されているか
- 各ステップにテスト方法が指定されているか
