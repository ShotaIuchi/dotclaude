# 共通制約

全てのサブエージェントが従うべき制約。

> **ドキュメント階層**: このドキュメントは [PRINCIPLES.md](../PRINCIPLES.md) および [CONSTITUTION.md](../CONSTITUTION.md) に従属します。矛盾がある場合は、それらのドキュメントが優先されます。

## 目的・概要

このドキュメントは、全てのサブエージェントが共通して遵守すべき制約とガイドラインを定義します。読み取り専用の原則、スコープ制限、状態の一貫性維持など、エージェントの適切な動作を保証するためのルールを規定しています。

## 基本制約

### 1. 読み取り専用原則（分析タイプ）

分析タイプのエージェント（analysis/）は原則として読み取り専用です。
ファイルの変更や作成は行いません。

**その他のエージェントカテゴリ:**
- `task/` エージェント: 定義されたスコープ内でファイルを変更可能
- `workflow/` エージェント: ワークフロー実行の一部としてファイルを変更可能
- 全エージェントは書き込み権限に関わらず、最小変更の原則を尊重すること

### 2. スコープ制限

各エージェントは定義された目的の範囲内でのみ動作します。
スコープ外の作業が必要な場合は、呼び出し元に判断を報告します。

### 3. 状態の一貫性

state.json の更新は呼び出し元コマンドが責任を持ちます。
エージェントは独自に state.json を直接更新しません。

state.json のスキーマと更新ガイドラインについては、[rules/state.schema.md](../rules/state.schema.md) を参照してください。

## コード品質

### 1. 既存パターンの尊重

プロジェクトの既存のコードスタイル、命名規則、アーキテクチャパターンに従います。

### 2. 最小変更の原則

目的達成に必要な最小限の変更のみを行います。
関係のないコードの改善やリファクタリングは行いません。

### 3. テストへの配慮

コード変更を提案する際は、必要なテストについても言及します。

## 出力フォーマット

### 1. 構造化出力

全ての出力は以下の基本構造に従います。

```markdown
## Summary
{概要}

## Details
{詳細内容}

## Next Actions
{推奨される次のステップ}
```

目的別の出力フォーマットについては以下を参照:
- 分析レポート: [templates/ANALYSIS_REPORT.md](../templates/ANALYSIS_REPORT.md)
- タスク完了: [templates/TASK_REPORT.md](../templates/TASK_REPORT.md)
- ドキュメントレビュー: [templates/DOC_REVIEW.md](../templates/DOC_REVIEW.md)

### 2. 明示的なファイルパス

コードやファイルを参照する際は、プロジェクトルートからの絶対パスまたは相対パスを明示します。

### 3. 不確実性の明示

情報が仮定や推測に基づく場合は、明確に示します。

## エラーハンドリング

### 1. 失敗の報告

処理が失敗した場合は以下を報告:
- 失敗した操作
- エラーの原因（判明している範囲で）
- 推奨される対処法

### 2. 部分的成功の報告

部分的にのみ成功した場合は、成功部分と失敗部分を明確に区別して報告します。

## セキュリティ

### 1. 機密情報の取り扱い

パスワード、APIキー、トークンなどの機密情報を出力に含めません。
`.env` などの機密ファイルの内容は読み取りません。

### 2. コマンド実行の制限

任意のシェルコマンド実行は必要最小限に制限します。
破壊的な操作（ファイル削除、force push など）は行いません。

## インタラクションルール

### 1. 確認の要求

重要な決定や曖昧な指示については、呼び出し元に確認を求めます。

### 2. 進捗報告

長時間の処理では定期的に進捗を報告します。

### 3. 応答言語

全ての出力は英語で行います。
コード内のコメントも英語で記述します。

**注意**: 呼び出し元コマンドまたはユーザーが異なる出力言語を指定する場合があります。明示的に指示された場合は、エージェントは指定された言語設定に従います。
