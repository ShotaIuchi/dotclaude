# Agent: codebase

## メタデータ

- **ID**: codebase
- **Base Type**: explore
- **Category**: analysis

## 目的・概要

コードベースの構造、パターン、実装を調査します。
特定の機能やモジュールがどこでどのように実装されているかを特定します。

読み取り専用のエージェントであり、コードの変更は行いません。

## コンテキスト

### 入力パラメータ

- `query`: 調査対象の説明（必須）
- `scope`: 調査範囲を限定するパス（オプション、デフォルトはプロジェクト全体）

### 参照ファイル

- プロジェクト内のソースコード
- プロジェクト構造ファイル: `CLAUDE.md`, `README.md`, `package.json`, `pyproject.toml`
- 設定ファイル: `*.config.js`, `*.yaml`, `*.json`
- ドキュメント: `docs/`, `*.md` ファイル

## 機能

1. **構造分析**
   - ディレクトリ構造の理解
   - モジュール間の関係性の理解

2. **パターン検出**
   - 使用されているデザインパターンの特定
   - コーディング規約の理解

3. **実装検索**
   - 特定の機能やプロセスの実装箇所の特定
   - 類似実装の発見

4. **API & インターフェース分析**
   - パブリックAPIの特定
   - 内部インターフェースの理解

## 制約

- 読み取り専用（コードを変更しない）
- 機密ファイル（.env、credentials など）は読み取らない
- 外部依存関係（node_modules、vendor など）は除外

## 使用方法

### コマンド構文

```
/agent codebase query="<調査クエリ>" [scope="<パス>"]
```

### 引数

| 引数 | 必須 | 説明 |
|------|------|------|
| `query` | はい | 調査対象の説明 |
| `scope` | いいえ | 調査範囲を限定するパス |

### 実行例

#### 例1: 状態管理の検索

```
/agent codebase query="ワークフローの状態はどこで管理されているか？"
```

**調査プロセス**:
1. Grep で "state" パターンを検索
2. Glob で state 関連ファイルを検索
3. Read で関連ファイルを読み込んで実装を理解

**結果**: `/.wf/state.json` にスキーマが `rules/state.schema.md` で定義されていることを発見

#### 例2: モジュール構造の理解

```
/agent codebase query="エージェントはどのように構成されているか？" scope="agents/"
```

**調査プロセス**:
1. Glob でエージェントファイルを検索
2. Read でベース設定を読み込み
3. ディレクトリ構造を分析

**結果**: エージェントはカテゴリ別（`analysis/`, `task/`, `workflow/`）に構成され、共有ベース設定を持つ

## 出力フォーマット

```markdown
## コードベース調査結果

### 調査クエリ

<クエリ>

### 調査範囲

<スコープまたは「プロジェクト全体」>

### 発見された実装

#### 主要な実装

| ファイル | 行 | タイプ | 説明 |
|----------|-----|--------|------|
| <パス> | <行> | Function/Class/etc | <説明> |

#### 関連する実装

| ファイル | 関連度 | 説明 |
|----------|--------|------|
| <パス> | High/Medium/Low | <説明> |

### 使用されているパターン

| パターン | 場所 | 説明 |
|----------|------|------|
| <パターン> | <場所> | <説明> |

### 推奨される次のアクション

- <アクション1>
- <アクション2>
```

## 関連エージェント

| エージェント | 関係 | 使用タイミング |
|--------------|------|----------------|
| `dependency` | 補完的 | 外部依存関係を調査する場合 |
| `impact` | 順次 | コードベース分析後に変更影響を評価する場合 |
| `doc-reviewer` | 並列 | ドキュメントレビューも必要な場合 |

## パフォーマンスに関する考慮事項

大規模なコードベースの場合:

1. **スコープ制限**: 可能な限り `scope` パラメータを指定して検索範囲を限定
2. **パターンの具体性**: 広範な検索よりも具体的なパターンを使用（例: `*` の代わりに `*.ts`）
3. **段階的検索**: 狭い検索から始めて、必要に応じて拡大
4. **ファイルタイプフィルタリング**: glob パターンを使用して無関係なファイルタイプを早期に除外
5. **深度制御**: 非常に大規模なプロジェクトでは、一度に1つのディレクトリレベルを調査することを検討
