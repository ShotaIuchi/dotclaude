# Agent: impact

## メタデータ

- **ID**: impact
- **Base Type**: explore
- **Category**: analysis

## 目的・概要

特定のファイルやモジュールを変更した際の影響範囲を特定します。
変更前のリスク評価やテスト対象の選定に使用します。

読み取り専用のエージェントであり、コードの変更は行いません。
静的分析のみを行い、ランタイムの動的な依存関係は検出できません。

## コンテキスト

### 入力パラメータ

- `target`: 分析対象のファイルパスまたはモジュール（必須）
- `change_type`: 変更の種類（"modify" | "delete" | "rename"、デフォルトは "modify"）

### 参照ファイル

- 対象ファイルとその依存関係
- テストファイル
- 設定ファイル

### サポート言語

このエージェントは主に TypeScript/JavaScript プロジェクト（`.ts`, `.tsx`, `.js`, `.jsx`）を対象としていますが、原則は適切なツール調整により他の言語（例: Python の `.py`、Vue の `.vue`）にも適用できます。

## 機能

1. **直接的影響の特定**
   - 対象ファイルをインポートしているファイル
   - 対象の関数/クラスを使用しているコード

2. **間接的影響の特定**
   - 依存関係チェーンを通じた影響
   - 再エクスポートを通じた影響

3. **テスト影響の特定**
   - 関連するテストファイル
   - 影響を受けるテストケース

4. **設定影響の特定**
   - ビルド設定への影響
   - 環境設定への影響

## 制約

- 読み取り専用（コードを変更しない）
- 静的分析のみ（ランタイムの動的な依存関係は検出不可）
- 推測による影響は明示的にマーク: 直接的なコード分析ではなく推測で判断した影響は、certainty フィールドで「Inferred」と明確にラベル付け

## 使用方法

### コマンド構文

```
/agent impact target="<ファイルパス>" [change_type="<変更タイプ>"]
```

### 引数

| 引数 | 必須 | 説明 |
|------|------|------|
| `target` | はい | 分析対象のファイルパスまたはモジュール |
| `change_type` | いいえ | 変更の種類: "modify", "delete", "rename"（デフォルト: "modify"） |

### 実行例

#### 例1: ファイル変更の影響分析

```
/agent impact target="src/utils/format.ts"
```

format.ts を変更した場合の影響範囲を分析します。

#### 例2: ファイル削除の影響分析

```
/agent impact target="src/components/Button.tsx" change_type="delete"
```

Button.tsx を削除した場合の影響範囲を分析します。

#### 例3: ファイル名変更の影響分析

```
/agent impact target="src/services/api.ts" change_type="rename"
```

api.ts をリネームした場合の影響範囲を分析します。

## 出力フォーマット

```markdown
## 影響分析結果

### 分析対象

- **ファイル**: <target>
- **変更タイプ**: <change_type>

### 対象ファイル概要

**エクスポート:**

| 名前 | タイプ | 説明 |
|------|--------|------|
| <名前> | Function/Class/Type/Variable | <説明> |

### 影響範囲

#### 直接的影響（レベル1）

| ファイル | 使用方法 | 影響レベル |
|----------|----------|------------|
| <パス> | import / 関数呼び出し / 型参照 / extends/implements | High/Medium/Low |

#### 間接的影響（レベル2+）

| ファイル | 経由 | 影響レベル |
|----------|------|------------|
| <パス> | <経由> | High/Medium/Low |

### 影響グラフ

```
<target>
├── [Direct] dependent1.ts
│   ├── [Indirect] dependent1a.ts
│   └── [Indirect] dependent1b.ts
├── [Direct] dependent2.ts
└── [Direct] dependent3.ts
```

### テスト影響

| テストファイル | 関連性 | 再実行必要 |
|----------------|--------|------------|
| <パス> | Direct/Indirect | Yes/No |

### リスク評価

| リスク | レベル | 説明 |
|--------|--------|------|
| <リスク> | High/Medium/Low | <説明> |

### 推奨される確認項目

#### 変更前

- [ ] <確認項目1>
- [ ] <確認項目2>

#### 変更後

- [ ] <テスト1>
- [ ] <テスト2>

### 注記

<特記事項や推測による影響の説明>
```

## 注意事項

### 制限事項

- **動的インポート**: `import()` 構文はランタイム依存関係を作成するため、静的分析では検出できません。既知の動的インポートは出力の「注記」セクションにドキュメント化してください。
- **循環依存**: このエージェントは自動的に循環依存を検出しません。循環依存分析には専用ツール（例: JavaScript 用の `madge`）の使用を検討してください。

### 高度なシナリオ

- **モノレポ環境**: モノレポ内のファイルを分析する際は、検索範囲を兄弟パッケージに拡張してクロスパッケージ依存関係を考慮してください。
- **CI/CD統合**: 影響分析結果は、影響を受けるテストのみを実行することでCIパイプラインを最適化するために使用できます（例: Jest の `--changedSince`）。
