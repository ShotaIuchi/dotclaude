# Review: wf0-schedule.md

> Reviewed: 2026-01-26
> Original: dotclaude/commands/wf0-schedule.md

## 概要 (Summary)

`/wf0-schedule` は、バッチワークフロー実行のためのスケジュール管理コマンドである。GitHub Issues、Jira Issues、ローカルワークからタスクを収集し、依存関係を分析して実行スケジュールを構築する。`create`、`show`、`edit`、`validate`、`clear` の5つのサブコマンドを提供し、DAG（有向非巡回グラフ）検証による循環依存の検出、優先度の自動計算などの機能を持つ。

## 評価 (Evaluation)

### 品質 (Quality)

- [x] **完全性 (Completeness)**: 必要な情報が網羅されている
- [x] **明確性 (Clarity)**: 読者にとって分かりやすい
- [x] **一貫性 (Consistency)**: 用語・スタイルが統一されている

### 技術的正確性 (Technical Accuracy)

- [x] **情報の正確性 (Correct information)**: 記載内容が正確
- [x] **最新性 (Up-to-date content)**: 情報が最新の状態

## 改善点 (Improvements)

### 優先度高 (High Priority)

| # | 箇所 | 問題 | 提案 | Status |
|---|------|------|------|--------|
| 1 | Helper Functions セクション | `wf_schedule_dfs` 関数がネストされた関数定義になっているが、bashでは関数内関数は一般的に推奨されない | 関数を分離するか、別のアプローチ（例: 関数を外部に定義）を検討 | Fixed (2026-01-26) |
| 2 | 3.1 create セクション | `works_collected` 配列への追加がwhileループ内で行われているが、パイプラインのサブシェルでは親シェルの変数に影響しない | `while read` をプロセス置換 `< <(...)` で置き換えるか、別の方法で実装 | Fixed (2026-01-26) |
| 3 | GitHub Issues取得部 | `eval` の使用はセキュリティリスクがある | 変数展開を直接使用するか、配列を使用してコマンドを構築 | Fixed (2026-01-26) |

### 優先度中 (Medium Priority)

| # | 箇所 | 問題 | 提案 | Status |
|---|------|------|------|--------|
| 1 | Jira統合部 | 「Jira integration requires API token configuration」のみで実装が不完全 | 実装予定か非対応かを明記し、対応する場合は config.json での設定例を追加 | Fixed (2026-01-26) |
| 2 | edit サブコマンド | 編集確認後の処理が `$edit_params` を参照しているが、この変数の取得方法が不明確 | Claudeとの対話フローを明確化するか、引数からの取得方法を追記 | Fixed (2026-01-26) |
| 3 | schedule.json スキーマ | `status` フィールドの値が複数箇所で異なる形式で記載（`"pending|running|paused|completed"` vs 個別記載） | 一貫した形式で記載 | Fixed (2026-01-26) |
| 4 | 依存関係検出パターン | 正規表現パターンが bash の `grep -oiE` と config.json の記法で異なる | 両方の記法を明確に区別して説明 | Fixed (2026-01-26) |

### 将来の検討事項 (Future Considerations)

- エラーハンドリングの強化：API呼び出し失敗時のリトライ機構
- スケジュールのインポート/エクスポート機能
- 並列実行数（`max_parallel`）の動的調整
- ワーク間の推定所要時間を考慮したスケジューリング
- `wf0-batch` コマンドとの連携部分の詳細ドキュメント
- Jira OAuth 2.0 認証の完全実装
- スケジュールの履歴管理・差分表示機能

## 総評 (Overall Assessment)

`wf0-schedule.md` は、バッチワークフロー管理のための包括的なコマンドドキュメントである。構造は明確で、サブコマンドごとの説明、ソース指定方法、ヘルパー関数、JSONスキーマ、出力例が網羅されており、高い完全性を持つ。

~~ただし、技術的な正確性において以下の懸念がある：~~
~~1. bashスクリプトの実装にサブシェル変数スコープの問題がある~~
~~2. `eval` の使用によるセキュリティリスク~~
~~3. Jira統合が未実装状態~~

**2026-01-26 Update:** 上記の技術的な問題はすべて修正されました：
1. サブシェル変数スコープ問題 - プロセス置換 `< <(...)` で解決
2. `eval` セキュリティリスク - 配列を使用したコマンド構築に変更
3. Jira統合 - 実装予定であることを明記し、config.json設定例を追加
4. ネストされた関数 - DFS関数を外部に分離
5. ステータス形式の一貫性 - 明確な説明を追加
6. 正規表現パターン - bash/JSON両記法の説明を追加

これらの問題を解決することで、実用的で堅牢なスケジュール管理機能として運用可能になる。ドキュメントとしては十分な情報量を持ち、開発者が実装の意図を理解するには適切な内容となっている。
